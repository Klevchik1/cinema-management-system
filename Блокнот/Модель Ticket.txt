class Ticket(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    screening = models.ForeignKey(Screening, on_delete=models.CASCADE)
    seat = models.ForeignKey(Seat, on_delete=models.CASCADE)
    group_id = models.CharField(max_length=40, blank=True, null=True, db_index=True)
    status = models.ForeignKey(TicketStatus, on_delete=models.PROTECT)
    
    def can_be_refunded(self):
        """Проверка возможности возврата билета"""
        from django.utils import timezone
        time_until_screening = self.screening.start_time - timezone.now()
        minutes_until = time_until_screening.total_seconds() / 60
        return minutes_until >= 30  # Возврат возможен за 30+ минут до сеанса