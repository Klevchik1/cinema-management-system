<div class="movies-report">
    <h2 style="color: var(--report-secondary); margin-bottom: 25px; font-size: 1.5rem; border-bottom: 2px solid var(--report-border); padding-bottom: 10px;">
        üé¨ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Ñ–∏–ª—å–º–æ–≤
    </h2>

    {% if report_data %}
        <!-- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ–¥–∏–Ω —Ä–∞–∑ -->
        {% load report_filters %}
        {% with aggregated=report_data|aggregate_movies_stats %}

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å —Ç–æ–ø —Ñ–∏–ª—å–º–∞–º–∏ -->
        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-label">–¢–æ–ø —Ñ–∏–ª—å–º</div>
                <div style="font-size: 1.1rem; font-weight: 600; margin: 10px 0; color: var(--report-secondary);">
                    {{ report_data.0.title|truncatechars:30 }}
                </div>
                <small style="color: var(--report-muted);">
                    {{ report_data.0.tickets_sold|default:0 }} –±–∏–ª–µ—Ç–æ–≤
                </small>
            </div>
            <div class="stat-card">
                <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                <div class="stat-number">{{ aggregated.total_revenue|floatformat:2 }} ‚ÇΩ</div>
                <small style="color: var(--report-muted);">–û—Ç –≤—Å–µ—Ö —Ñ–∏–ª—å–º–æ–≤</small>
            </div>
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ –±–∏–ª–µ—Ç–æ–≤</div>
                <div class="stat-number">{{ aggregated.total_tickets }}</div>
                <small style="color: var(--report-muted);">–ü—Ä–æ–¥–∞–Ω–æ</small>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ —Ñ–∏–ª—å–º–æ–≤ -->
        <table class="report-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>–§–∏–ª—å–º</th>
                    <th>–ñ–∞–Ω—Ä</th>
                    <th>–ü—Ä–æ–¥–∞–∂–∏</th>
                    <th>–í—ã—Ä—É—á–∫–∞</th>
                    <th>–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                {% for movie in report_data %}
                <tr>
                    <td style="text-align: center; font-weight: bold; color: var(--report-secondary);">
                        {{ forloop.counter }}
                    </td>
                    <td>
                        <div style="font-weight: 600; color: var(--report-text); margin-bottom: 3px;">
                            {{ movie.title }}
                        </div>
                        <div style="font-size: 0.85rem; color: var(--report-muted);">
                            {{ movie.age_rating }} ‚Ä¢
                            {% if movie.duration %}
                                {{ movie.duration }}
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <span class="badge">{{ movie.genre }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="badge info">{{ movie.tickets_sold|default:0 }}</span>
                        <small style="display: block; color: var(--report-muted);">
                            –±–∏–ª–µ—Ç–æ–≤
                        </small>
                    </td>
                    <td>
                        <div style="font-weight: bold; color: var(--report-success);">
                            {{ movie.total_revenue|default:0|floatformat:2 }} ‚ÇΩ
                        </div>
                    </td>
                    <td style="text-align: center; font-weight: bold; color: var(--report-secondary);">
                        {{ movie.popularity_percentage|default:0|floatformat:1 }}%
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endwith %}
    {% else %}
        <div class="alert">
            ‚ÑπÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å–º–æ–≤ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
        </div>
    {% endif %}
</div>