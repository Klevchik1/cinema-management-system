{% load report_filters %}
<div class="revenue-report">
    <h2 style="color: var(--report-secondary); margin-bottom: 25px; font-size: 1.5rem; border-bottom: 2px solid var(--report-border); padding-bottom: 10px;">
        üìà –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    </h2>

    {% if report_data %}
        <!-- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
        {% with total_revenue=report_data|sum_revenue total_tickets=report_data|sum_tickets total_avg=report_data|total_avg_ticket_price %}

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ -->
        <div class="stat-grid">
            <div class="stat-card">
                <div class="stat-label">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
                <div class="stat-number">{{ total_revenue|floatformat:2 }} ‚ÇΩ</div>
                <small style="color: var(--report-muted);">–ó–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥</small>
            </div>
            <div class="stat-card">
                <div class="stat-label">–í—Å–µ–≥–æ –±–∏–ª–µ—Ç–æ–≤</div>
                <div class="stat-number">{{ total_tickets }}</div>
                <small style="color: var(--report-muted);">–ü—Ä–æ–¥–∞–Ω–æ</small>
            </div>
            <div class="stat-card">
                <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
                <div class="stat-number">
                    {{ total_avg|floatformat:2 }} ‚ÇΩ
                </div>
                <small style="color: var(--report-muted);">–ù–∞ –±–∏–ª–µ—Ç</small>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
        <table class="report-table">
            <thead>
                <tr>
                    <th>–ü–µ—Ä–∏–æ–¥</th>
                    <th>–í—ã—Ä—É—á–∫–∞ (‚ÇΩ)</th>
                    <th>–ü—Ä–æ–¥–∞–Ω–æ –±–∏–ª–µ—Ç–æ–≤</th>
                    <th>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</th>
                </tr>
            </thead>
            <tbody>
                {% for item in report_data %}
                <tr>
                    <td style="font-weight: 600;">
                        {% if item.date %}
                            <span class="badge primary">{{ item.date|date:"d.m.Y" }}</span>
                        {% elif item.week %}
                            –ù–µ–¥–µ–ª—è {{ item.week }}, {{ item.year }}
                        {% else %}
                            {{ item.month }}/{{ item.year }}
                        {% endif %}
                    </td>
                    <td style="font-weight: bold; color: var(--report-success);">
                        {{ item.revenue|default:0|floatformat:2 }} ‚ÇΩ
                    </td>
                    <td style="text-align: center;">
                        <span class="badge info">{{ item.tickets_sold }}</span>
                    </td>
                    <td style="font-weight: 600; color: var(--report-secondary);">
                        {{ item|avg_ticket_price|floatformat:2 }} ‚ÇΩ
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td style="padding: 14px 16px; font-weight: bold;">–ò—Ç–æ–≥–æ:</td>
                    <td style="padding: 14px 16px; font-weight: bold; color: var(--report-success);">
                        {{ total_revenue|floatformat:2 }} ‚ÇΩ
                    </td>
                    <td style="padding: 14px 16px; text-align: center; font-weight: bold;">
                        <span class="badge primary">{{ total_tickets }}</span>
                    </td>
                    <td style="padding: 14px 16px; font-weight: bold; color: var(--report-secondary);">
                        {{ total_avg|floatformat:2 }} ‚ÇΩ
                    </td>
                </tr>
            </tfoot>
        </table>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–∏–æ–¥–µ -->
        <div style="margin-top: 30px; padding: 20px; background: var(--report-card-bg); border-radius: 8px; border: 1px solid var(--report-border);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="margin: 0 0 5px 0; color: var(--report-secondary);">üìÖ –ê–Ω–∞–ª–∏–∑ –∑–∞ –ø–µ—Ä–∏–æ–¥</h4>
                    <p style="margin: 0; color: var(--report-muted);">
                        –û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∑–∞ {{ report_data|length }} –¥–Ω–µ–π
                    </p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.9rem; color: var(--report-muted);">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: var(--report-secondary);">
                        {{ total_revenue|floatformat:2 }} ‚ÇΩ
                    </div>
                </div>
            </div>
        </div>
        {% endwith %}
    {% else %}
        <div class="alert">
            ‚ÑπÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—ã—Ä—É—á–∫–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
        </div>
    {% endif %}
</div>