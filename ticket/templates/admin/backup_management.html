{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
    .backup-section {
        background: var(--darkened-bg);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
        border: 1px solid var(--border-color);
        color: var(--body-fg);
    }
    .backup-form {
        margin: 15px 0;
        padding: 15px;
        background: var(--body-bg);
        border-radius: 4px;
        border: 1px solid var(--border-color);
    }
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin: 5px;
        text-decoration: none;
        display: inline-block;
    }
    .btn-primary {
        background: var(--primary);
        color: var(--button-fg);
    }
    .btn-secondary {
        background: var(--secondary);
        color: var(--button-fg);
    }
    .btn:hover {
        opacity: 0.9;
    }
    .backup-list {
        margin-top: 20px;
    }
    .backup-item {
        background: var(--body-bg);
        padding: 15px;
        margin: 10px 0;
        border-radius: 4px;
        border-left: 4px solid var(--primary);
        color: var(--body-fg);
    }
    .form-group {
        margin: 15px 0;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: var(--body-fg);
    }
    input[type="date"] {
        padding: 8px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        font-size: 14px;
        margin-right: 10px;
        background: var(--body-bg);
        color: var(--body-fg);
    }
    h1, h2, h3 {
        color: var(--body-fg);
    }
    p {
        color: var(--body-fg);
    }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>üóÉÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h1>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
        <ul class="messagelist">
            {% for message in messages %}
                <li class="{% if message.tags %}{{ message.tags }}{% endif %}">
                    {{ message }}
                </li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ -->
    <div class="backup-section">
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±—ç–∫–∞–ø</h2>

        <!-- –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø -->
        <div class="backup-form">
            <h3>–ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h3>
            <p>–°–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="full_backup">
                <button type="submit" class="btn btn-primary">
                    üóÉÔ∏è –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
                </button>
            </form>
        </div>

        <!-- –î–Ω–µ–≤–Ω–æ–π –±—ç–∫–∞–ø -->
        <div class="backup-form">
            <h3>–ë—ç–∫–∞–ø –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å</h3>
            <p>–°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É</p>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="daily_backup">
                <div class="form-group">
                    <label for="backup_date">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</label>
                    <input type="date" id="backup_date" name="backup_date" required>
                    <button type="submit" class="btn btn-secondary">
                        üìÖ –°–æ–∑–¥–∞—Ç—å –¥–Ω–µ–≤–Ω–æ–π –±—ç–∫–∞–ø
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±—ç–∫–∞–ø–æ–≤ -->
    <div class="backup-section">
        <h2>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±—ç–∫–∞–ø—ã</h2>

        {% if backups %}
            <div class="backup-list">
                {% for backup in backups %}
                    <div class="backup-item">
                        <strong>{{ backup.name }}</strong><br>
                        <small>–§–∞–π–ª: {{ backup.backup_file }}</small><br>
                        <small>–¢–∏–ø: {{ backup.get_backup_type_display }}</small><br>
                        <small>–î–∞—Ç–∞: {{ backup.backup_date|default:"-" }}</small><br>
                        <small>–°–æ–∑–¥–∞–Ω: {{ backup.created_at|date:"Y-m-d H:i:s" }}</small><br>
                        <small>–†–∞–∑–º–µ—Ä: {{ backup.file_size }}</small><br>
                        <small>–°—Ç–∞—Ç—É—Å:
                            <span style="color: {% if backup.file_exists %}var(--message-success-bg){% else %}var(--message-error-bg){% endif %};">
                                {{ backup.file_status }}
                            </span>
                        </small>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>–ë—ç–∫–∞–ø—ã –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã</p>
        {% endif %}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
    <div style="margin-top: 20px;">
        <a href="{% url 'admin:ticket_backupmanager_changelist' %}" class="btn" style="background: var(--secondary); color: var(--button-fg);">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –±—ç–∫–∞–ø–æ–≤
        </a>
    </div>
</div>

<script>
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –∫–∞–∫ —Å–µ–≥–æ–¥–Ω—è
    document.getElementById('backup_date').max = new Date().toISOString().split('T')[0];
</script>
{% endblock %}